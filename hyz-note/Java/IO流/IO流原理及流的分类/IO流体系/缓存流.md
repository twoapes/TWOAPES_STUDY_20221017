# 缓冲流

缓冲流是Java I/O中提供的一种装饰器（Decorator）类，用于提高I/O操作的性能。它们是字节缓冲流（BufferedInputStream、BufferedOutputStream）和字符缓冲流（BufferedReader、BufferedWriter）两种类型。

缓冲流通过在内部创建一个缓冲区（Buffer），将数据暂时存储在缓冲区中，然后进行批量读取或写入操作，减少了对底层资源的直接访问次数，从而提高了I/O操作的效率。

缓冲流的工作原理如下：

1.创建缓冲流对象：在创建缓冲流对象时，需要将底层的输入流或输出流作为参数传递给缓冲流的构造函数。

2.创建缓冲区：缓冲流内部会创建一个缓冲区，大小根据实现而定，默认为8192字节。

3.读写操作：当进行读取操作时，缓冲流会从底层输入流中读取一定量的数据，并将其存储在缓冲区中。当进行写入操作时，缓冲流会将数据暂时存储在缓冲区中，然后批量写入到底层输出流中。

4.刷新缓冲区：缓冲区在达到一定条件（如缓冲区满、调用flush()方法、关闭流等）时会自动刷新，将缓冲区中的数据写入到底层流中。

5.关闭流：在关闭缓冲流时，会自动关闭底层的输入流或输出流。

缓冲流的优点包括：

6.提高性能：缓冲流采用了批量读写的方式，减少了对底层资源的访问次数，提高了读写操作的效率。

7.减少系统开销：缓冲流可以减少对系统资源的占用，减少了频繁的I/O操作，提高了系统的响应速度。

8.支持标记和重置：缓冲流支持对流进行标记和重置操作，方便在某些情况下回退到之前的位置。

需要注意的是，缓冲流在提高性能的同时，也会引入一定的延迟，因为数据需要先存储在缓冲区中。因此，在处理实时性要求较高的场景下，可能需要权衡使用缓冲流带来的性能提升和延迟。

总之，缓冲流是一种用于提高I/O操作性能的装饰器类，通过引入缓冲区来减少对底层资源的访问次数，提高了读写操作的效率。使用缓冲流可以改

善大量数据读写的性能，并提供了一些额外的功能，如标记和重置操作。

为了提高数据读写的速度，Java API提供了带缓冲功能的流类，在使用这些流类时，会创建一个内部缓冲区数组，缺省使用8192个字节(8Kb)的缓冲区

缓冲流要“套接”在相应的节点流之上，根据数据操作单位可以把缓冲流分为

`BufferedInputStream 和 BufferedOutputStream
BufferedReader 和 BufferedWriter`

- 当读取数据时，数据按块读入缓冲区，其后的读操作则直接访问缓冲区

- 当使用BufferedInputStream读取字节文件时，BufferedInputStream会一次性从文件中读取8192个(8Kb)，存在缓冲区中，直到缓冲区装满了，才重新从文件中读取下一个8192个字节数组

- 向流中写入字节时，不会直接写到文件，先写到缓冲区中直到缓冲区写满，BufferedOutputStream才会把缓冲区中的数据一次性写到文件里。使用方法flush()可以强制将缓冲区的内容全部写入输出流

- 关闭流的顺序和打开流的顺序相反。只要关闭最外层流即可，关闭最外层流也会相应关闭内层节点流

- flush()方法的使用：手动将buffer中内容写入文件

- 如果是带缓冲区的流对象的close()方法，不但会关闭流，还会在关闭流之前刷新缓冲区，关闭后不能再写出

以下是一个使用`BufferedWriter`写入文件内容的示例代码：

```java
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;

public class BufferedWriterDemo {
    public static void main(String[] args) {
        File file = new File("path/to/file.txt");

        try (BufferedWriter writer = new BufferedWriter(new FileWriter(file))) {
            String data = "Hello, World!";
            
            writer.write(data);

            System.out.println("数据已写入文件！");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

在上述示例中，我们使用`BufferedWriter`来创建一个字符缓冲输出流对象，并将其包装在`FileWriter`中，用于向指定文件中写入数据。

然后，我们将字符串`"Hello, World!"`使用`write()`方法写入缓冲输出流。

最后，我们打印一条消息表示数据已成功写入文件。

同样，我们使用了Java 7引入的try-with-resources语句来自动关闭缓冲流，以确保在写入完文件后，不论是否发生异常，都会正确关闭流以释放资源。

在实际使用中，请将示例中的`"path/to/file.txt"`替换为你实际要写入的文件的路径。同样，为了避免可能的异常情况，建议在实际使用时进行适当的异常处理。
