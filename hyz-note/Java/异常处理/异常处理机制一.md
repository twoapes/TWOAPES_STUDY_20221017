# 异常处理机制一

## try-catch-finally

在编写程序时，经常要在可能出现错误的地方加上检测的代码，如进行x/y运算时，要检测分母为0，数据为空，输入的不是数据而是字符等

过多的if-else分支会导致程序的代码加长、臃肿，可读性差因此采用异常处理机制

Java采用的异常处理机制，是将异常处理的程序代码集中在一起，与正常的程序代码分开，使得程序简洁、优雅，并易于维护

- Java提供的是异常处理的抓抛模型

- Java程序的执行过程中如出现异常，会生成一个异常类对象，该异常对象将被提交给Java运行时系统，这个过程称为抛出(throw)异常

- 异常对象的生成

由虚拟机自动生成：程序运行过程中，虚拟机检测到程序发生了问题，如果在当前代码中没有找到相应的处理程序，就会在后台自动创建一个对应异常类的实例对象并抛出--自动抛出

由开发人员手动创建：`Exception exception = new ClassCastException();`——创建好的异常对象不抛出对程序没有任何影响，和创建一个普通对象一样

- 如果一个方法内抛出异常，该异常对象会被抛给调用者方法中处理

  如果异常没有在调用者方法中处理，它继续被抛给这个调用方法的上层方法

  这个过程将一直继续下去，直到异常被处理,这一过程称为捕获(catch)异常

- 如果一个异常回到main()方法，并且main()也不处理，则程序运行终止

- 程序员通常只能处理Exception，而对Error无能为力

异常处理是通过try-catch-finally语句实现的

- try

捕获异常的第一步是用try{...}语句块选定捕获异常的范围,将可能出现异常的代码放在try语句块中

- catch(Exceptiontype e)

在catch语句块中是对异常对象进行处理的代码

每个try语句块可以伴随一个或多个catch语句,用于处理可能产生的不同类型的异常对象

如果明确知道产生的是何种异常，可以用该异常类作为catch的参数

也可以用其父类作为catch的参数

> 比如：可以用ArithmeticException类作为参数的地方， 就可以用RuntimeException类作为参数， 或者用所有异常的父类Exception类作为参数。
但不能是与ArithmeticException类无关的异常
如NullPointerException(catch中的语句将不会执行)

## 捕获异常的有关信息

与其它对象一样，可以访问一个异常对象的成员变量或调用它的方法

> getMessage() 获取异常信息，返回字符串
printStackTrace() 获取异常类名和异常信息，以及异常出现在程序中的位置,返回值void

## 异常概述与异常体系结构

RuntimeException、Error以及它们的子类都称为**免检异常**(unchecked exception)

所有其他异常都称为**必检异常**(checked exception) ， 意味着编译器会强制程序员检查并通过try-catch块处理它们， 或者在方法头进行声明

Java的异常处理模型基于三种操作

- 声明一个异常(declaring an exception)

- 抛出一个异常(throwing an exception)

- 捕获一个异常(catching an exception)

下面是一个Java程序的示例，展示了 `try-catch-finally` 块的用法：

```java
public class Example {
  public static void main(String[] args) {
    try {
      int[] numbers = {1, 2, 3};
      System.out.println(numbers[3]); // 尝试访问一个越界的数组元素
    } catch (ArrayIndexOutOfBoundsException e) {
      System.out.println("Caught an exception: " + e.getMessage());
    } finally {
      System.out.println("Finally block executed"); // 无论是否发生异常，都会执行
    }
  }
}
```

在这个示例中，我们尝试访问一个数组的第四个元素，但数组只有三个元素。这将导致 `ArrayIndexOutOfBoundsException` 异常被抛出。我们使用 `try-catch` 块捕获这个异常，并打印异常消息。

我们还在 `finally` 块中打印了一条消息，以证明它无论是否发生异常都会被执行。

当我们运行这个程序时，它将输出：

```txt
Caught an exception: 3
Finally block executed
```

在这个示例中，我们可以看到 `try-catch-finally` 块的工作原理。我们使用 `try` 块来尝试执行一些可能会导致异常的代码。如果异常被抛出，我们使用 `catch` 块来捕获它，并处理它。无论是否发生异常，`finally` 块中的代码都会被执行，以确保必要的清理操作被执行。

总之，`try-catch-finally` 块是Java中用于捕获异常并处理它们的结构。它允许我们尝试执行一些可能会引发异常的代码，并在必要时处理这些异常。无论是否发生异常，`finally` 块中的代码都会被执行。
